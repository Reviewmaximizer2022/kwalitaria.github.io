/*!
 * WooCommerce Restaurant Ordering 2.1
 * Copyright 2022 Barn2 Plugins
 */
!function(t,e,r,o){"use strict";let a=e.wc_restaurant_ordering_params||{};if(t.isEmptyObject(a))return void console.warn("WooCommerce Restaurant Ordering - script params not defined");let n=function(t){const e=t.getResponseHeader("X-WP-Nonce");e&&(a.rest_nonce=e)},i=function(){const o="wc-restaurant-product-modal";let i=null,d=t("html, body");function c(t){if(t&&"object"==typeof t?(this.productData=t,this.productId=parseInt(this.productData.product_id,10)):this.productId=parseInt(t,10),this.$modal=[],this.$cart=[],this.$quantity=[],this.$price=[],this.$addonsTotal=[],!this.productId)return e.console&&e.console.warn("Invalid product ID provided for product modal."),!1}function u(e){if(!(e=e||l()).length)return;let r=t.Event("keydown");r.which=27,e.trigger(r)}function l(){return t(r.body).children("#wc-backbone-modal-dialog")}function p(t){t.data.modal.addRemoveQuantity(!0),t.data.modal.$modal.trigger("wro:modal:add_quantity")}function f(t){t.data.modal.addRemoveQuantity(!1),t.data.modal.$modal.trigger("wro:modal:remove_quantity")}function m(t){if(t.data.modal.hasProductAddons())return!0;t.data.modal.$modal.trigger("wro:modal:change_quantity")}function h(t){let e=t.data.modal,r=e.$addonsTotal.data("price_data"),o=e.$price,a=0;if(!Array.isArray(r)||!o.length)return!0;r.length&&(a=r.reduce((function(t,e){if(!("cost_raw"in e))return t;let r=parseFloat(e.cost_raw);return isNaN(r)?t:t+r}),a)),e.setExtras(a)}function _(t){t.data.modal.updatePrice()}function g(e){let r=t(e.target),o=e.data.modal,i=o.$modal;o.hideOrderError(!0);let s=function(e){let r=(o=e,n={},t.each(o.serializeArray(),(function(e,r){-1!==r.name.indexOf("[]")?(r.name=r.name.replace("[]",""),n[r.name]=t.makeArray(n[r.name]),n[r.name].push(r.value)):n[r.name]=r.value})),n);var o,n;let i={isValid:!1,message:!1};return t.isEmptyObject(r)||!("product_id"in r)?(i.message=a.messages.error_adding_item,i):("quantity"in r||(r.quantity=1),r.quantity?"variation_id"in r&&0===parseInt(r.variation_id,10)?(i.message=a.messages.select_all_required_options,i):(t("select, input, textarea",e).each((function(){let e=t(this).prop("name");if(-1!==e.indexOf("[]")&&(e=e.replace("[]","")),t(this).prop("required")&&(!(e in r)||""===r[e]))return i.message=a.messages.select_all_required_options,i})),i.message||(i.isValid=!0),i.formData=r,i):(i.message=a.messages.enter_quantity_greater_than_0,i))}(r);return s.isValid?(i.trigger("wro:modal:before_add_product",[s.formData]),t.ajax({url:a.rest_url+a.rest_endpoints.cart,method:"POST",data:s.formData,dataType:"json",headers:{"X-WP-Nonce":a.rest_nonce}}).done((function(t,e,r){n(r),i.trigger("wro:add_product",[t]),i.trigger("wro:modal:add_product",[t])})).always((function(){i.trigger("wro:modal:add_product_complete"),u(i)})).fail((function(t,e,r){console.error&&console.error(t.responseText),i.trigger("wro:add_product_fail").trigger("wro:modal:add_product_fail")})),!1):(o.showOrderError(s.message),!1)}function y(t,e){if(o!==e)return!0;let r=l();if(!r.length)return!0;r.trigger("wro:modal:close")}function w(){d.addClass("wc-restaurant-modal-active")}function b(){d.removeClass("wc-restaurant-modal-active")}function v(t){t.data.modal.block()}function $(t){t.data.modal.unblock()}function q(t,e,r){i&&"data"in r&&r.data.indexOf("action=wc_product_addons_calculate_tax")>=0&&i.block()}function k(t,e,r){i&&i.unblock()}return c.prototype.load=function(){if(t.isEmptyObject(this.productData))return t.ajax({url:a.rest_url+a.rest_endpoints.modal+"/"+this.productId,method:"GET",dataType:"json",cache:!0,context:this,headers:{"X-WP-Nonce":a.rest_nonce}}).done((function(e,o,a){n(a),e.success?(t(r.body).trigger("wro:modal:load",e),this.productData=e.product_data,this.open()):s.showCartNotice(e)})).fail((function(t,e,r){console.error&&console.error(t.responseText),s.showCartNotice({error_message:a.messages.item_cannot_be_loaded})}));this.open()},c.prototype.open=function(){t.isEmptyObject(this.productData)||(u(),t("<div/>").WCBackboneModal({template:o,variable:this.productData}),this.init(),this.$modal.trigger("wro:modal:open"))},c.prototype.init=function(){this.$modal=l(),this.$modal.length&&(this.$cart=this.$modal.find(".cart"),this.$cart.length&&(this.$quantity=this.$cart.find("input.qty"),this.$price=this.$cart.find("#product-total-"+this.productId),this.$addonsTotal=this.$cart.find("#product-addons-total")),this.bindEvents(),this.initPlugins(),this.initVariations(),this.$modal.trigger("wro:modal:init"))},c.prototype.bindEvents=function(){this.$modal.off(".restaurantOrder").on("wro:modal:open",w).on("wro:modal:close",b).on("click.restaurantOrder",".quantity .add",{modal:this},p).on("click.restaurantOrder",".quantity .remove",{modal:this},f).on("change.restaurantOrder",".quantity .qty",{modal:this},m).on("wro:modal:update_price wro:modal:change_quantity",{modal:this},_).on("updated_addons.restaurantOrder",".cart",{modal:this},h).on("wro:modal:before_add_product",{modal:this},v).on("wro:modal:add_product_complete",{modal:this},$).on("submit.restaurantOrder",".cart",{modal:this},g),t(r).on("wc_backbone_modal_before_remove.restaurantOrder",y),this.hasProductAddons()&&t(r).ajaxSend(q).ajaxComplete(k)},c.prototype.initPlugins=function(){let e=this.$modal;this.initAddons(),t.fn.wc_pb_bundle_form&&e.find(".bundle_form .bundle_data").each((function(){var e=t(this);0===e.closest(".composite_form").length&&e.wc_pb_bundle_form()})),t.fn.wc_composite_form&&e.find(".composite_form .composite_data").each((function(){t(this).wc_composite_form()}))},c.prototype.initAddons=function(){let e=this.$modal,r=e.find(".wc-pao-addons-container");r.length&&(e.trigger("quick-view-displayed"),r.find(".wc-pao-addon-checkbox-group-required").each((function(){let e=this;t(e).find(".wc-pao-addon-checkbox").change((function(){t(e).find("input:checked").length>0?(t(e).removeClass("wc-pao-addon-checkbox-required-error"),t(e).find("input").each((function(){t(this).attr("required",!1)}))):(t(e).addClass("wc-pao-addon-checkbox-required-error"),t(e).find("input").each((function(){t(this).attr("required",!0)})))}))})))},c.prototype.initVariations=function(){if(!t.fn.wc_variation_form)return;let e=this;e.$modal.find("form.variations_form").first().wc_variation_form().on("reset_data",(function(){e.resetVariations()})).on("found_variation",(function(t,r){e.setVariation(r)}))},c.prototype.getQuantity=function(){if(!this.$quantity.length)return 0;let t=parseFloat(this.$quantity.val());return t=isNaN(t)?0:t,t},c.prototype.setQuantity=function(t){this.$quantity.length&&this.$quantity.val(t).trigger("change")},c.prototype.addRemoveQuantity=function(t){if(t=!!t,!this.$quantity.length)return;let r=function(t,r,o,a,n){!1!==n&&(n=!0),r=parseFloat(r),o=parseFloat(o),a=parseFloat(a),r=isNaN(r)?1:r,o=isNaN(o)?-1:o,a=isNaN(a)?1:a,o>0&&o<r&&(o=r);let i=parseFloat(t);return isNaN(i)?i=r:n?(i+=a,o>0&&(i=e.Math.min(i,o))):(i-=a,i=e.Math.max(i,r)),i}(this.$quantity.val(),this.$quantity.prop("min"),this.$quantity.prop("max"),this.$quantity.prop("step"),t);this.setQuantity(r)},c.prototype.updatePrice=function(){if(!this.$price.length)return;let t=this.getQuantity(),r=parseFloat(this.$price.data("itemPrice")),o=this.$price.data("extrasPerItem"),n=this.$price.data("extras");var i;isNaN(r)||(o||(o=0),n||(n=0),this.$price.html((i=n+t*(r+o),"function"!=typeof e.accounting.formatMoney?i:e.accounting.formatMoney(i,{symbol:a.price_currency_symbol,decimal:a.price_decimal_sep,thousand:a.price_thousand_sep,precision:a.price_num_decimals,format:a.price_currency_format}))))},c.prototype.setPrice=function(t){this.$price.length&&this.$price.data("itemPrice",t).trigger("wro:modal:update_price")},c.prototype.setExtras=function(t){this.$price.length&&this.$price.data("extras",t).trigger("wro:modal:update_price")},c.prototype.resetVariations=function(){this.$cart.find(".order button, .order .qty").prop("disabled",!0).addClass("disabled");let t=this.$cart.find('input[name="variation_id"]');t.length&&""===t.val()&&t.val("0"),this.resetVariationData()},c.prototype.setVariation=function(t){if(this.resetVariationData(),t.is_purchasable&&t.is_in_stock&&t.variation_is_visible){this.$cart.find(".order button, .order .qty").prop("disabled",!1).removeClass("disabled"),this.$quantity.length&&("min_qty"in t&&this.$quantity.prop("min",t.min_qty),"max_qty"in t&&this.$quantity.prop("max",t.max_qty)),this.setPrice(t.display_price);let e=this.$cart.find(".options .variations-data");t.variation_description&&e.append(t.variation_description),a.show_stock_in_modal&&t.availability_html&&e.append(t.availability_html)}else this.$cart.find(".order button, .order .qty").prop("disabled",!0).addClass("disabled"),t.is_in_stock?this.showOrderError(a.messages.item_not_available):this.showOrderError(a.messages.item_out_of_stock)},c.prototype.resetVariationData=function(){this.$cart.find(".options .variations-data").empty(),this.hideOrderError()},c.prototype.showOrderError=function(e){this.hideOrderError(!0),t('<p class="order-error">'+e+"</p>").prependTo(this.$cart.find(".order")).slideDown(150)},c.prototype.hideOrderError=function(t){let e=t&&!0===t?0:150;this.$cart.find(".order > .order-error").slideUp(e,(function(){this.remove()}))},c.prototype.hasProductAddons=function(){return this.$addonsTotal.length&&"undefined"!=typeof woocommerce_addons_params},c.prototype.block=function(){this.$cart.length&&this.$cart.find(".buy").addClass("block")},c.prototype.unblock=function(){this.$cart.length&&this.$cart.find(".buy").removeClass("block")},{load:function(t){return i=new c(t),i.load()},show:function(t){i=new c(t),i.open()},close:u,getCurrentModal:function(){return i},getModalElement:l,setExtras:function(t){i&&i.setExtras(t)},setPrice:function(t){i&&i.setPrice(t)}}}(),s=function(){let e=null,o=[];function s(o,n){if(!e)return;o=t.extend({success:!1,error_message:""},o),n=n||("cart_notice_timeout"in a?a.cart_notice_timeout:2800);let i=t(e(o));i.appendTo(r.body).slideDown(),setTimeout((function(){i.fadeOut((function(){this.remove()}))}),n)}function d(e){return e=parseInt(e,10),t(r.body).trigger("wro:before_check_order_type",e),t.ajax({url:a.rest_url+a.rest_endpoints.order_type+"/"+e,method:"GET",dataType:"json",cache:!0,headers:{"X-WP-Nonce":a.rest_nonce}}).done((function(e,o,a){n(a),t(r.body).trigger("wro:check_order_type",[e])})).always((function(){t(r.body).trigger("wro:check_order_type_complete")})).fail((function(e,o,a){console.error&&console.error(e.responseText),t(r.body).trigger("wro:check_order_type_fail")}))}function c(e,o){if(e=parseInt(e,10),o=parseFloat(o),!e||!o)return!1;const i={product_id:e,quantity:o};return t(r.body).trigger("wro:before_add_product",[i]),t.ajax({url:a.rest_url+a.rest_endpoints.cart,method:"POST",data:i,dataType:"json",headers:{"X-WP-Nonce":a.rest_nonce}}).done((function(e,o,a){n(a),t(r.body).trigger("wro:add_product",e).trigger("wro:quick_add_product",e)})).always((function(){t(r.body).trigger("wro:add_product_complete")})).fail((function(e,o,a){console.error&&console.error(e.responseText),t(r.body).trigger("wro:add_product_fail")}))}function u(t){t.removeClass("block")}function l(e){let r=t(e.target),o=r.parents(".wc-restaurant-menu-product"),a=o.data("productId")||0,n=o.data("orderType")||!1,l=o.data("quantity")||1,p=!1,f=!0;if(!a)return!0;let m=o;if(m=r.hasClass("add")?r:t(".price",o),m.addClass("block"),"check"===n)p=d(a).done((function(t,e,r){t.success?(o.data("orderType",t.order_type),"quick"===t.order_type?(f=!1,c(a,l).always((function(){u(m)}))):"product_data"in t&&i.show(t.product_data)):s(t)}));else if("quick"===n)p=c(a,l);else{if(o.data("modal"))return!1;o.data("modal",!0),p=i.load(a)}return p&&p.always((function(){o.data("modal",!1),f&&u(m)})),!1}function p(e,o){var n;o.success?(a.show_cart_notice&&s(o),a.refresh_cart&&"fragments"in o&&(n=o.fragments)&&(t.each(n,(function(e){t(e).addClass("updating").fadeTo("400","0.6").block({message:null,overlayCSS:{opacity:.6}})})),t.each(n,(function(e,r){t(e).replaceWith(r),t(e).stop(!0).css("opacity","1").unblock()})),t(r.body).trigger("wro:update_fragments").trigger("wc_fragments_loaded")),t(r.body).trigger("added_to_cart",[o.fragments,o.cart_hash])):s(o)}function f(){s({success:!1})}return{init:function(){o=t(".wc-restaurant-menu-section"),o.off(".restaurantOrder").on("click.restaurantOrder",".clickable .wc-restaurant-menu-product",l).on("click.restaurantOrder",".wc-restaurant-menu-product .add",l),t(r.body).on("wro:add_product",p).on("wro:add_product_fail",f),e=wp.template("wc-restaurant-cart-notice")},addRemoveProduct:c,checkOrderType:d,showCartNotice:s}}(),d=function(){let r=[],o=[],n=0;function i(){o.forEach((e=>function(e){let r=e.items.offset().top;e.moreDropdown.empty(),e.items.children().each((function(o,a){let n=t(a);n.offset().top>r&&e.moreDropdown.append(n.clone())})),e.more[e.moreDropdown.children().length?"removeClass":"addClass"]("hidden")}(e)))}function s(e){return t(this).siblings(".more-dropdown").slideToggle(200),!1}function d(e){let r=t(this).closest(".wc-restaurant-navigation"),o=t(".wc-restaurant-navigation-items",r),a=t(".more-dropdown",r);o.children().removeClass("active"),a.children().removeClass("active"),a.slideUp(200),t(this).parent("li").addClass("active");let i=this.getAttribute("href"),s=t(i);if(i&&s.length){let e=s.first().offset().top-n;return t("html, body").animate({scrollTop:e},"slow"),!1}return!0}return{init:function(){r=t(".wc-restaurant-navigation"),r.length&&(n=function(){let e=0;"nav_scroll_offset"in a&&Number(a.nav_scroll_offset)&&(e=a.nav_scroll_offset);let r=t("#wpadminbar");return r.length&&"fixed"===r.css("position")&&(e+=t("html").offset().top),Number(e)}()+12,r.each((function(){o.push({items:t(".wc-restaurant-navigation-items",this),more:t(".wc-restaurant-navigation-more",this),moreDropdown:t(".more-dropdown",this)})})),r.on("click","a",d),r.on("click",".more-button",s),t(e).resize(i),i())}}}(),c=function(){function o(){t("<div/>").WCBackboneModal({template:"wc-restaurant-info-modal"});let e=t(r.body).children("#wc-backbone-modal-dialog");return e.length&&e.find("#wro-info-copy-address").on("click",n),!1}function n(){let o=t(this),n=o.siblings(".address-text");if(!n.length)return!1;let i=r.createRange();i.selectNode(n.get(0)),e.getSelection().addRange(i);try{r.execCommand("copy")&&t('<span class="address-copied">'+a.messages.address_copied+"</span>").insertAfter(o).delay(650).fadeOut(400,(function(){t(this).remove()}))}catch(t){}return e.getSelection().removeAllRanges(),!1}return{init:function(){t(".wc-restaurant-info-more").on("click","a",o)}}}();e.wcRestaurantMenu=s,e.wcRestaurantProductModal=i,t((function(){s.init(),d.init(),c.init()}))}(jQuery,window,document);